<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="utf-8">
    <title>Arch Linux学习：Repository与Pacman小记</title>
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta name="description" content="">
    <meta name="author" content="laoyi">

    <!-- Le styles -->
    <link rel="stylesheet" href="/theme/css/bootstrap.min.css" type="text/css" />
    <style type="text/css">
      body {
        padding-top: 60px;
        padding-bottom: 40px;
      }
      .sidebar-nav {
        padding: 9px 0;
      }
      .tag-1 {
        font-size: 13pt;
      }
      .tag-2 {
        font-size: 10pt;
      }
      .tag-2 {
        font-size: 8pt;
      }
      .tag-4 {
        font-size: 6pt;
     }
    </style>
    <link href="/theme/css/bootstrap-responsive.min.css" rel="stylesheet">
        <link href="/theme/css/font-awesome.css" rel="stylesheet">

    <link href="/theme/css/pygments.css" rel="stylesheet">

    <!-- Le HTML5 shim, for IE6-8 support of HTML5 elements -->
    <!--[if lt IE 9]>
      <script src="//html5shim.googlecode.com/svn/trunk/html5.js"></script>
    <![endif]-->

    <!-- Le fav and touch icons -->
    <link rel="shortcut icon" href="/theme/images/favicon.ico">
    <link rel="apple-touch-icon" href="/theme/images/apple-touch-icon.png">
    <link rel="apple-touch-icon" sizes="72x72" href="/theme/images/apple-touch-icon-72x72.png">
    <link rel="apple-touch-icon" sizes="114x114" href="/theme/images/apple-touch-icon-114x114.png">

    <link href="/" type="application/atom+xml" rel="alternate" title="老逸的个人站 ATOM Feed" />
    <link href="/feeds/all.rss.xml" type="application/atom+xml" rel="alternate" title="老逸的个人站 RSS Feed" />

  </head>

  <body>

    <div class="navbar navbar-fixed-top">
      <div class="navbar-inner">
        <div class="container-fluid">
          <a class="btn btn-navbar" data-toggle="collapse" data-target=".nav-collapse">
            <span class="icon-bar"></span>
            <span class="icon-bar"></span>
            <span class="icon-bar"></span>
          </a>
          <a class="brand" href="/index.html">老逸的个人站 </a>
          <div class="nav-collapse">
            <ul class="nav">
                <li><a href="/pages/about.html">About</a></li>
                          <li class="divider-vertical"></li>
                  <li >
                    <a href="/category/coding.html">
						<i class="icon-folder-open icon-large"></i>Coding
					</a>
                  </li>
                  <li >
                    <a href="/category/life.html">
						<i class="icon-folder-open icon-large"></i>Life
					</a>
                  </li>
                  <li class="active">
                    <a href="/category/linux.html">
						<i class="icon-folder-open icon-large"></i>Linux
					</a>
                  </li>
                  <li >
                    <a href="/category/tool.html">
						<i class="icon-folder-open icon-large"></i>Tool
					</a>
                  </li>
                  <li >
                    <a href="/category/web.html">
						<i class="icon-folder-open icon-large"></i>Web
					</a>
                  </li>

                          <ul class="nav pull-right">
                                <li><a href="/archives.html"><i class="icon-th-list"></i>Archives</a></li>
                          </ul>

            </ul>
            <!--<p class="navbar-text pull-right">Logged in as <a href="#">username</a></p>-->
          </div><!--/.nav-collapse -->
        </div>
      </div>
    </div>

    <div class="container-fluid">
      <div class="row">
        <div class="span9" id="content">
<section id="content">
        <article>
                <header>
                        <h1>
                                <a href=""
                                        rel="bookmark"
                                        title="Permalink to Arch Linux学习：Repository与Pacman小记">
                                        Arch Linux学习：Repository与Pacman小记
                                </a>
                        </h1>
                </header>
                <div class="entry-content">
                <div class="well">
<footer class="post-info">
<span class="label">Date</span>
<abbr class="published" title="2014-01-17T19:30:00+08:00">
        <i class="icon-calendar"></i>五 17 一月 2014
</abbr>
<span class="label">By</span>
<a href="/author/laoyi.html"><i class="icon-user"></i>laoyi</a>
<span class="label">Category</span>
<a href="/category/linux.html"><i class="icon-folder-open"></i>Linux</a>.


<span class="label">Tags</span>
	<a href="/tag/arch-linux.html"><i class="icon-tag"></i>Arch Linux</a>
</footer><!-- /.post-info -->                </div>
                <p>本系列博文记录学习Arch Linux这个Linux发行版过程中的总结与收获。</p>
<hr class="docutils" />
<div class="section" id="arch-linux">
<h2>Arch Linux 仓库</h2>
<div class="section" id="id1">
<h3>仓库的分类</h3>
<p>Arch Linux的官方仓库包含如下的五个类别：
Core, Extra, Community，Multilib，Testing</p>
</div>
<div class="section" id="id2">
<h3>仓库简介</h3>
<p><strong>core</strong></p>
<p>core仓库包含了所有系统必备的包。
例如bootloader，kernel，building packages等。
貌似安装系统的时候敲pacstrap的时候就是通过连接镜像站点并获取core内容完成本地系统安装的。</p>
<p><strong>extra</strong></p>
<p>extra仓库包含了所有不是系统必须的包。
类似于Firefox啦X11图形界面啦mplayer啦都在里面。
另外Python之类的也属于extra的内容。
据说这个仓库比较庞大，毕竟许多常用的东西都在里面。</p>
<p><strong>community</strong></p>
<p>这个仓库存放了所有社区中可信用户提交并获得投票通过的包。</p>
<p>社区中用户可以提交自己的包到AUR中，
所谓的AUR全称是Arch User Repository，
用户可以在AUR中下载并编译别人写的包，
再让pacman安装到自己的系统中。</p>
<p>经过大家的使用鉴定，
可以通过投票表决某些好用的包进入community仓库。</p>
<p>AUR和community的关系就显而易见了，
pacman只能直接获取community的内容，
AUR的东西需要自行下载安装。</p>
<p><strong>multilib</strong></p>
<p>有点神奇的仓库，
存放了许多32位的库文件，
针对64位系统提供32位软件的构建和执行的能力。</p>
<p><strong>testing</strong></p>
<p>顾名思义，
正在测试的包可以在这个仓库里找到。
一个包被弄进testing的原因一种是可能会破坏当前的系统，因此需要测试；
或者是正等待其他依赖的包重新构建。</p>
<p>testing中的包最终会被弄进core或者extra里面去。</p>
<hr class="docutils" />
<p>博主查看了本地的pacman设置文件，
默认情况下pacman只启用core,extra和community三个仓库。</p>
</div>
</div>
<div class="section" id="pacman">
<h2>Pacman的简介、配置与基本命令</h2>
<p>Pacman是Arch Linux的包管理器，
类似于Ubuntu的apt，
提供了自动化的依赖关系管理维持、
自动化的仓库更新和本地系统更新，
以及本地的包管理。</p>
<div class="section" id="id3">
<h3>相关文件</h3>
<pre class="literal-block">
pacman的日志记录：/var/log/pacman.log
pacman的配置文件：/etc/pacman/pacman.conf
pacman的镜像列表：/etc/pacman.d/mirrorlist
pacman的本地cache文件夹：/var/cache/pacman/pkg/
</pre>
</div>
<div class="section" id="id4">
<h3>配置</h3>
<p>pacman的配置文件在这里: /etc/pacman.conf</p>
<p>可以查man pacman.conf看到所有配置的字段。</p>
<p>在Repository块中去掉对应的项前面的注释便可以启用相应的仓库，
包括testing、multilib等。
注意使用testing的时候需要把它放置在仓库列表的最上一项，
因为testing中的包与其他仓库的包可能重名。</p>
<p>没事还是别拿testing开玩笑的好。</p>
<p>另外在IgnorePkg后面的包将会被pacman无视，不会自动更新。
在IgnoreGroup后面的组也不会被更新。</p>
<p>不推荐使用Ignore，
因为连带的更新会让依赖的包版本变化，
某些单独的包不被更新很容易出现依赖问题。</p>
<p>这种事情在博主安装virtualbox的时候就出现过，
由于kernel版本过旧导致依赖kernel的virtualbox出现问题无法启动。</p>
<p>都是些不太常用的配置。</p>
<p>下面这货才是主要的，
镜像列表的编辑：</p>
<p>从这里搞一份镜像列表：</p>
<blockquote>
<a class="reference external" href="https://www.archlinux.org/mirrorlist/">https://www.archlinux.org/mirrorlist/</a></blockquote>
<p>贴到本地的mirrorlist文件中：</p>
<blockquote>
/etc/pacman.d/mirrorlist</blockquote>
</div>
<div class="section" id="id5">
<h3>常用命令</h3>
<p><strong>刷新包列表</strong></p>
<p>如前面的博文说过的，
更新过mirrorlist的话要用这货更新包的列表：</p>
<blockquote>
pacman -Syy</blockquote>
<p><strong>安装</strong></p>
<p>安装特定的若干个包敲这个命令：</p>
<blockquote>
pacman -S package1 package2 ......</blockquote>
<p>也可以安装一个组，例如gnome：</p>
<blockquote>
pacman -S gnome</blockquote>
<p>这种情况下pacman会出一个列表询问需要安装包组里面的哪些特定的包，或者是全部。</p>
<p>有时候在多个仓库中存在相同的包，那么需要在名称前加入仓库名称指定：</p>
<blockquote>
pacman -S repo_name/package_name</blockquote>
<p>跟apt一样，
不用处理依赖关系，
pacman会自动连带安装所有必须的依赖。</p>
<p>另外博主在使用的时候发现，
在安装好某些包后可选的依赖也会被列举出来，
提醒用户可安装某些额外的功能。</p>
<p>在某个包已被安装的情况下，
pacman会尝试重新安装，
不管当前的版本是否有差别。
这种特性可以通过加入 --needed 选项去除。</p>
<p><em>特殊的安装</em></p>
<blockquote>
pacman -U path/to/file.pkg.tar.xz</blockquote>
<p>上面这货可以从本地安装不在镜像服务器中的包。
用于从AUR中下载的包需要这种安装方式。
此外上面的路径可以换成url。</p>
<p><strong>删除</strong></p>
<p>删除某个包（仅删除该包，没有处理依赖）：</p>
<blockquote>
pacman -R package</blockquote>
<p>删除某个包并把它的依赖（如果没有被其他包依赖的话）连带删除：</p>
<blockquote>
pacman -Rs package</blockquote>
<p>删除某个包、其依赖的包、以及依赖它的包： (-_-)</p>
<blockquote>
pacman -Rsc package</blockquote>
<p>删除某个包并忽略所有依赖它的包：</p>
<blockquote>
pacman -Rdd package</blockquote>
<p>/*这里有一个补充说明，
默认情况下pacman是不允许删除被依赖的包的，
博主在之前删除ibus的时候，
ibus-googlepinyin还存在依赖关系，
导致pacman 报错退出。*/</p>
<p><strong>升级</strong></p>
<p>全自动升级</p>
<blockquote>
pacman -Syu</blockquote>
<p>官方的说法是升级的时候需要小心，
需要确定pacman列出的升级列表，
还要确定是否需要手动处理一些配置文件的替换工作。</p>
<p>可供参考的有arch官方的RSS订阅，announce的邮件列表以及twitter账户。</p>
<p><strong>查询数据库</strong></p>
<p>数据库有两款，
其一是本地local数据库，
保存的是当前系统安装的包;
其二是远端镜像sync仓库中当前的列表，
保存所有最新的数据。</p>
<p>可用-Q参数查询local库，
用-S参数查询sync数据库。</p>
<p>搜索包含某个关键词的包：</p>
<blockquote>
pacman -Ss string1 string2 string3 ...</blockquote>
<p>搜索本地库就把S改成Q：</p>
<blockquote>
pacman -Qs string1 ...</blockquote>
<p>加入i参数可查看某个包的详细信息(注意上面是字段搜索，这个是包名称)：</p>
<blockquote>
pacman -Si package</blockquote>
<p>同样，查看本地：</p>
<blockquote>
pacman -Qi package</blockquote>
<p>两个i的话可以查看连带的备份文件及编辑状态(啥...)</p>
<blockquote>
pacman -Qii package</blockquote>
<p>列出所有该包安装的文件(拿kernel试了一发，效果不错)：</p>
<blockquote>
pacman -Ql package</blockquote>
<p>反向查询某个文件属于的包：</p>
<blockquote>
pacman -Qo path/to/file</blockquote>
<p>列出所有不再被依赖的包(一直在纠结能不能把搜出来的东西给删掉...)：</p>
<blockquote>
pacman -Qdt</blockquote>
<p>还能树状列出某个包的依赖：</p>
<blockquote>
pactree package</blockquote>
</div>
<div class="section" id="id6">
<h3>缓存的相关内容</h3>
<p>pacman的安装机制是这样的，
首先从mirrorlist中查询url，
从url中搜索是否存在目标包，
如果没有的话则返回404，
继续搜索下一个url，
找到的话则下载对应的包。</p>
<p>下载完成放在cache目录里，
也就是/var/cache/pacman/pkg</p>
<p>最后从本地的cache中安装对应的包到系统里面，
完成。</p>
<p>升级也是一样的处理，
下载并存放到cache里，
再安装新版本的软件。</p>
<p>于是ls一发cache目录可以找到所有之前安装过的包文件。</p>
<p>根据Arch官方的说法，保留旧版本的包的好处在于如果新版本运行出现问题，
可以使用手头的旧版本降级处理解决。</p>
<p>但感觉咱这种循规蹈矩整天看着wiki安装extra仓库东西的人，
应该不会手气太差，
加上那么一堆安装包感觉很占地方。</p>
<p>于是可以使用下面的命令清理一下：</p>
<p>清除所有旧版本的包：</p>
<blockquote>
pacman -Sc</blockquote>
<p>Arch的推荐是确定当前版本没有问题的情况下才执行这种操作，
否则出现问题比较麻烦。</p>
<p>清除缓存：</p>
<blockquote>
pacman -Scc</blockquote>
<p>整个缓存清空。Arch官方不推荐这种操作。</p>
<hr class="docutils" />
<p>pacman的基本用法就这么多了，
查询其他额外信息，找man是不错的选择，另外也可以去这里：</p>
<blockquote>
<a class="reference external" href="https://wiki.archlinux.org/index.php/Pacman">https://wiki.archlinux.org/index.php/Pacman</a></blockquote>
</div>
</div>

                </div><!-- /.entry-content -->
        </article>
        <license>
        <br/>
        This work by <a xmlns:cc="http://creativecommons.org/ns#" href="http://www.scutlaoyi.tk" property="cc:attributionName" rel="cc:attributionURL">scutLaoYi</a> is licensed under a <a rel="license" href="http://creativecommons.org/licenses/by-sa/4.0/">Creative Commons Attribution-ShareAlike 4.0 International License</a>.
        </license>
</section>
        </div><!--/span-->

                <div class="span3 well sidebar-nav" id="sidebar">
<ul class="nav nav-list">
<li class="nav-header"><h4><i class="icon-time"></i>time</h4></li>
<li><p id="pagetimer"></p></li>

<li class="nav-header"><h4><i class="icon-list-alt"></i>PAGE SENTENCE</h4></li>
<li>
<p id="page-sentence">
当你看到这句的时候，说明每页一句载入失败...烦请告知博主!谢谢!(^_^)
</p>
</li>
<script src="/add_ons/pagesentence/sentence.js"></script>
<script src="/add_ons/clock/clock.js"></script>
<script>
window.onload=function(){
      var pagetimer = document.getElementById("pagetimer");
      pagetimer.innerHTML = getcurrenttime();
  setInterval(function(){
      pagetimer.innerHTML = getcurrenttime();
      }, 1000);

    document.getElementById("page-sentence").innerHTML = generateSentence();
}
</script>
<li class="nav-header"><h4><i class="icon-external-link"></i>link</h4></li>
    <li><a href="http://github.com/scutlaoyi"><i class="icon-external-link"></i>my github</a></li>
<li class="nav-header"><h4><i class="icon-home icon-large"></i> social</h4></li>
<!--<li><a href="/" rel="alternate"><i
    class="icon-bookmark icon-large"></i>atom feed</a></li>-->
<li><a href="/feeds/all.rss.xml" rel="alternate"><i class="icon-bookmark icon-large"></i>rss feed</a></li>
    <li><a href=""><i class="icon--sign icon-large"></i></a></li>

<li class="nav-header"><h4><i class="icon-folder-close icon-large"></i>Categories</h4></li>
<li>
<a href="/category/coding.html">
    <i class="icon-folder-open icon-large"></i>Coding
</a>
</li>
<li>
<a href="/category/life.html">
    <i class="icon-folder-open icon-large"></i>Life
</a>
</li>
<li>
<a href="/category/linux.html">
    <i class="icon-folder-open icon-large"></i>Linux
</a>
</li>
<li>
<a href="/category/tool.html">
    <i class="icon-folder-open icon-large"></i>Tool
</a>
</li>
<li>
<a href="/category/web.html">
    <i class="icon-folder-open icon-large"></i>Web
</a>
</li>

<li class="nav-header"><h4><i class="icon-tags icon-large"></i>Tags</h4></li>
<li class="tag-3">
    <a href="/tag/vim.html">
        <i class="icon-tag icon-large"></i>Vim
    </a>
</li>
<li class="tag-4">
    <a href="/tag/page-sentences.html">
        <i class="icon-tag icon-large"></i>page sentences
    </a>
</li>
<li class="tag-4">
    <a href="/tag/xss.html">
        <i class="icon-tag icon-large"></i>xss
    </a>
</li>
<li class="tag-3">
    <a href="/tag/proxy.html">
        <i class="icon-tag icon-large"></i>proxy
    </a>
</li>
<li class="tag-4">
    <a href="/tag/android.html">
        <i class="icon-tag icon-large"></i>Android
    </a>
</li>
<li class="tag-2">
    <a href="/tag/bash.html">
        <i class="icon-tag icon-large"></i>Bash
    </a>
</li>
<li class="tag-2">
    <a href="/tag/audition.html">
        <i class="icon-tag icon-large"></i>audition
    </a>
</li>
<li class="tag-2">
    <a href="/tag/git.html">
        <i class="icon-tag icon-large"></i>git
    </a>
</li>
<li class="tag-4">
    <a href="/tag/mysql.html">
        <i class="icon-tag icon-large"></i>MySQL
    </a>
</li>
<li class="tag-4">
    <a href="/tag/md5.html">
        <i class="icon-tag icon-large"></i>md5
    </a>
</li>
<li class="tag-3">
    <a href="/tag/tor.html">
        <i class="icon-tag icon-large"></i>Tor
    </a>
</li>
<li class="tag-1">
    <a href="/tag/cc.html">
        <i class="icon-tag icon-large"></i>C/C++
    </a>
</li>
<li class="tag-3">
    <a href="/tag/litecoin.html">
        <i class="icon-tag icon-large"></i>litecoin
    </a>
</li>
<li class="tag-2">
    <a href="/tag/socket.html">
        <i class="icon-tag icon-large"></i>socket
    </a>
</li>
<li class="tag-2">
    <a href="/tag/web-tool.html">
        <i class="icon-tag icon-large"></i>web tool
    </a>
</li>
<li class="tag-1">
    <a href="/tag/python.html">
        <i class="icon-tag icon-large"></i>Python
    </a>
</li>
<li class="tag-2">
    <a href="/tag/recruitment.html">
        <i class="icon-tag icon-large"></i>recruitment
    </a>
</li>
<li class="tag-2">
    <a href="/tag/softwarearchitect.html">
        <i class="icon-tag icon-large"></i>SoftwareArchitect
    </a>
</li>
<li class="tag-1">
    <a href="/tag/data-structure.html">
        <i class="icon-tag icon-large"></i>data structure
    </a>
</li>
<li class="tag-1">
    <a href="/tag/arch-linux.html">
        <i class="icon-tag icon-large"></i>Arch Linux
    </a>
</li>
<li class="tag-2">
    <a href="/tag/github.html">
        <i class="icon-tag icon-large"></i>github
    </a>
</li>


</ul>        </div><!--/.well -->

      </div><!--/row-->

      <hr>

      <footer>
        <address id="about">
                Proudly powered by <a href="http://pelican.notmyidea.org/">Pelican <i class="icon-external-link"></i></a>,
                                which takes great advantage of <a href="http://python.org">Python <i class="icon-external-link"></i></a>.
        </address><!-- /#about -->

        <p>The theme is from <a href="http://twitter.github.com/bootstrap/">Bootstrap from Twitter <i class="icon-external-link"></i></a>,
                   and <a href="http://fortawesome.github.com/Font-Awesome/">Font-Awesome <i class="icon-external-link"></i></a>, thanks!</p>
      </footer>

    </div><!--/.fluid-container-->



    <!-- Le javascript -->
    <!-- Placed at the end of the document so the pages load faster -->
    <script src="/theme/js/jquery-1.7.2.min.js"></script>
    <script src="/theme/js/bootstrap.min.js"></script>
  </body>
</html>