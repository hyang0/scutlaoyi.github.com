<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="utf-8">
    <title>玩转莱特币：使用CPUMiner和proxy挖矿的办法</title>
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta name="description" content="">
    <meta name="author" content="laoyi">

    <!-- Le styles -->
    <link rel="stylesheet" href="/theme/css/bootstrap.min.css" type="text/css" />
    <style type="text/css">
      body {
        padding-top: 60px;
        padding-bottom: 40px;
      }
      .sidebar-nav {
        padding: 9px 0;
      }
      .tag-1 {
        font-size: 13pt;
      }
      .tag-2 {
        font-size: 10pt;
      }
      .tag-2 {
        font-size: 8pt;
      }
      .tag-4 {
        font-size: 6pt;
     }
    </style>
    <link href="/theme/css/bootstrap-responsive.min.css" rel="stylesheet">
        <link href="/theme/css/font-awesome.css" rel="stylesheet">

    <link href="/theme/css/pygments.css" rel="stylesheet">

    <!-- Le HTML5 shim, for IE6-8 support of HTML5 elements -->
    <!--[if lt IE 9]>
      <script src="//html5shim.googlecode.com/svn/trunk/html5.js"></script>
    <![endif]-->

    <!-- Le fav and touch icons -->
    <link rel="shortcut icon" href="/theme/images/favicon.ico">
    <link rel="apple-touch-icon" href="/theme/images/apple-touch-icon.png">
    <link rel="apple-touch-icon" sizes="72x72" href="/theme/images/apple-touch-icon-72x72.png">
    <link rel="apple-touch-icon" sizes="114x114" href="/theme/images/apple-touch-icon-114x114.png">

    <link href="/" type="application/atom+xml" rel="alternate" title="老逸的个人站 ATOM Feed" />
    <link href="/feeds/all.rss.xml" type="application/atom+xml" rel="alternate" title="老逸的个人站 RSS Feed" />

  </head>

  <body>

    <div class="navbar navbar-fixed-top">
      <div class="navbar-inner">
        <div class="container-fluid">
          <a class="btn btn-navbar" data-toggle="collapse" data-target=".nav-collapse">
            <span class="icon-bar"></span>
            <span class="icon-bar"></span>
            <span class="icon-bar"></span>
          </a>
          <a class="brand" href="/index.html">老逸的个人站 </a>
          <div class="nav-collapse">
            <ul class="nav">
                <li><a href="/pages/about.html">About</a></li>
                          <li class="divider-vertical"></li>
                  <li >
                    <a href="/category/coding.html">
						<i class="icon-folder-open icon-large"></i>Coding
					</a>
                  </li>
                  <li >
                    <a href="/category/life.html">
						<i class="icon-folder-open icon-large"></i>Life
					</a>
                  </li>
                  <li >
                    <a href="/category/linux.html">
						<i class="icon-folder-open icon-large"></i>Linux
					</a>
                  </li>
                  <li >
                    <a href="/category/tool.html">
						<i class="icon-folder-open icon-large"></i>Tool
					</a>
                  </li>
                  <li class="active">
                    <a href="/category/web.html">
						<i class="icon-folder-open icon-large"></i>Web
					</a>
                  </li>

                          <ul class="nav pull-right">
                                <li><a href="/archives.html"><i class="icon-th-list"></i>Archives</a></li>
                          </ul>

            </ul>
            <!--<p class="navbar-text pull-right">Logged in as <a href="#">username</a></p>-->
          </div><!--/.nav-collapse -->
        </div>
      </div>
    </div>

    <div class="container-fluid">
      <div class="row">
        <div class="span9" id="content">
<section id="content">
        <article>
                <header>
                        <h1>
                                <a href=""
                                        rel="bookmark"
                                        title="Permalink to 玩转莱特币：使用CPUMiner和proxy挖矿的办法">
                                        玩转莱特币：使用CPUMiner和proxy挖矿的办法
                                </a>
                        </h1>
                </header>
                <div class="entry-content">
                <div class="well">
<footer class="post-info">
<span class="label">Date</span>
<abbr class="published" title="2014-06-16T10:00:00+08:00">
        <i class="icon-calendar"></i>一 16 六月 2014
</abbr>
<span class="label">By</span>
<a href="/author/laoyi.html"><i class="icon-user"></i>laoyi</a>
<span class="label">Category</span>
<a href="/category/web.html"><i class="icon-folder-open"></i>Web</a>.


<span class="label">Tags</span>
	<a href="/tag/litecoin.html"><i class="icon-tag"></i>litecoin</a>
</footer><!-- /.post-info -->                </div>
                <p>挖矿分为两种，
简单暴力的直接挖矿，
以及加入矿池进行合体挖矿。</p>
<p>由于现在的全网算力已经超乎想象(博主玩的时候大概为300GH/s)，
没有专用矿机只能选择矿池挖矿。</p>
<p>由于博主以娱乐为主，
没有钱和精力购买高速专用矿机，
甚至没有好的显卡拿来用GPU挖矿，
因此使用的是简单的CPU挖矿方式(10KH/s......)。</p>
<p>如果正儿八经的想赚点钱，
推荐至少要弄个好的显卡用GPU挖矿。</p>
<p>在网上有一些算力的统计表，
AMD系列的显卡跑GPU挖矿一般可以达到100KH/s以上。</p>
<div class="section" id="id1">
<h2>矿池的选择</h2>
<p>由于博主用的是大陆的局域网，
选择矿池显得比较困难。</p>
<p>首先需要排除掉那些没什么人的矿池，
听说没什么人的矿池由于全池算力都很差，
因此找到新块的几率非常低，
进而导致每个矿工分到的收益也很小。</p>
<p>此外，
由于网络的问题，
需要选择能够稳定连接的矿池，
否则经常断线就只能白白消耗电能。</p>
<blockquote>
<p>现在的矿池基本上都支持stratum协议，
这种协议本质上是建立一个代理服务器中转矿机和目标服务器的连接，
由于有了这种类似于buffer的协议层，
相比最初的getwork方式直连，
不仅网络的带宽占用变小，
连接的稳定性等各方面也有较好的提升。</p>
<p>许多矿池甚至强制性使用stratum协议，
例如coinotron。</p>
</blockquote>
<p>矿池的选择可以参考莱特币的info页面：</p>
<pre class="literal-block">
https://litecoin.info/Mining_pool_comparison
</pre>
<p>选择好矿池后，
在网站里注册一个新的用户，
4位的PIN码非常重要，
各种操作都需要PIN码。
有些矿池支持Google的身份验证器，
推荐开启。</p>
<blockquote>
<p>不过很多矿池不支持更换验证器，
而且没有备选的身份识别方案，
导致一旦验证器失效就无法控制账户了。</p>
<p>博主刚好手机换系统，
结果验证器就失效了，
wemineLTC网站的账户控制丢失...</p>
<p>也好，
wemineLTC的算力现在处在危险的垄断地位，
不推荐大家加入wemineLTC矿池中，
防止51%攻击。</p>
</blockquote>
<p>然后添加几个新的矿工，
由于矿工只是用于识别，
没有什么安全性危机（不会有人偷矿工，因为工作量算在矿工头上），
因此可以随意设置名称和密码（密码甚至都是明文..）。</p>
<p>虽然很多矿池支持多个矿机使用同一个矿工帐号，
但是不推荐使用，
因为超过一定数量后可能会被识别为机器人，
机器人帐号会被踢出矿池，
博主猜测此举是为了阻止坏人制作病毒传播用别人的机器挖矿。</p>
</div>
<div class="section" id="id2">
<h2>挖矿回报类型的选择</h2>
<p>矿工和矿池之间是合作的关系，
挖出来的矿根据何种协议进行划分就相当重要了。</p>
<p>常见的回报有PPS和PPLNS，
以及其他多种细碎的类型。
由于博主只体验过这两种，
因此仅对他们做简单介绍，
详细情况依然可以查看莱特币的info页面。</p>
<p><strong>PPS</strong></p>
<p>简单说来PPS是指矿工的每一次有效的挖掘都计算到工作量中去，
这种方式不会受到矿池整体情况的影响，
只要有工作量，
就可以直接兑换为莱特币。</p>
<blockquote>
<p>这种协议对矿池来说危险系数比较高，
假设矿池寻找新区块的几率很大，
那么没有问题大家都有钱拿。
然而如果矿池不景气，
运气不好连续很长时间都没有找到区块，
那么矿池就可能会亏本，
因为矿工的薪水仍然需要分发。</p>
<p>因此使用这种协议一般矿池会收取比较高的费率，
通常在2%左右，
作为维持矿池运转的手段。</p>
<p>但对于小型的散户来说，
使用PPS的话风险比较低，
因为只要矿工一直在运行，
就一直能够获得收益。</p>
</blockquote>
<p><strong>PPLNS</strong></p>
<p>这种协议与上面的刚好相反，
矿工按照工作量在矿池的比重进行收益计算，
而不是工作量的净值。</p>
<blockquote>
<p>同样假设矿池效率高，
一天找到一大堆新的块，
那么就捞到了大把的莱特币，
每个矿工根据在挖矿过程中自己工作量占矿池总工作量的比值得到相应的莱特币。
大家都分到很多钱。</p>
<p>然而如果矿池几天才捞到一个新块，
那么矿工同样拿这个新块的收益按比值划分收益，
每个矿工能够得到的钱就非常少了。</p>
<p>这种方案的好处是矿池比较保险，
不需要承担由于运气不好带来的损失。
因此PPLNS的收费也会相应的降低。</p>
<p>然而对于矿工来说，
运气成分也占据了一部分，
因此PPLNS不太适合博主这种闹着玩的人，
有可能几天都捞不到半毛莱特币。
哦，不对，
半毛莱特币值五十美分，
因为现在的汇率是LTC:USD = 1:11，
还是挺多的。</p>
</blockquote>
<p>博主选择的是PPS协议，
虽然手续费什么的比较高，
但看着自己账户的金额一点一点往上涨还是很有成就感的，
相比之下，
前期使用PPLNS跑过一个晚上，
结果账户金额一直没有动静，
玩得很不爽。</p>
</div>
<div class="section" id="id3">
<h2>安装工具</h2>
<p>博主的系统是Linux系，
因此以下的内容都以Linux为目标。
但CPU挖矿感觉两个平台的操作基本相同。</p>
<p>基本套路是装两个程序，
一个是stratum-proxy代理程序，
一个是cpuminer挖矿主程序。</p>
<p><strong>矿机下载</strong></p>
<p>首先下载cpuminer:</p>
<pre class="literal-block">
http://sourceforge.net/projects/cpuminer/files/?source=navbar
</pre>
<p>不知道为什么2.4版本在博主的系统上跑有问题，
一直无法连接，
而选择2.2.3版本则运行良好。
各位读者可自行尝试。</p>
<p><strong>proxy下载</strong></p>
<p>下载stratum-proxy:</p>
<pre class="literal-block">
https://github.com/bandroidx/stratum-mining-proxy
</pre>
<p>按照教程直接安装即可，
教程就在readme文件里面。</p>
<p>记得跑一遍midstate文件夹里的make，
可以大幅提高速度和稳定性，
没有搞这个的时候十几分钟就会固定断线一次，
而且很恶心的无法重连。</p>
<p><strong>补充安装的service_identity</strong></p>
<p>博主启动代理服务器的时候会有一个Warning，
显示缺少service_identity的组件，
虽然仍然能够正常使用，
但后来也安装了这个组件：</p>
<pre class="literal-block">
https://pypi.python.org/pypi/service_identity
</pre>
<p>首先下载源码，
解压到任意目录并用终端进入，
然后执行python setup.py install，
可能需要root权限，
等待跑完即可。</p>
</div>
<div class="section" id="id4">
<h2>启动挖矿</h2>
<p><strong>proxy的启动</strong></p>
<p>首先需要启动proxy，
在proxy的目录下敲：</p>
<pre class="literal-block">
./mining_proxy.py -pa scrypt -o server_url -p server_port
</pre>
<p>第一个参数指定了算法类型，
听说除了比特币以外所有电子货币都是使用scrypt算法。
不添加这个参数也是可以正常启动的，
矿机也跑得很欢快，
cpu占用也是满的，
但是网站的监测显示算力一直为零...</p>
<p>server_url为矿池服务器的地址，
server_port为矿池服务器的端口，
这些可以在矿池的网站里面找到，
注意端口要与对应的币种相同，
比如挖莱特币的别跑到狗币的端口去。</p>
<p>proxy的设置主要是与矿池服务器的连接，
一切正常的话会有一堆输出，
这样保持proxy持续运行即可，
另外要注意观察有没有ERROR。</p>
<p><strong>miner的启动</strong></p>
<p>如果没有更改proxy的端口的话，
proxy的本地端口应该为8332，
因此可以在miner目录下通过下述的命令启动矿机：</p>
<pre class="literal-block">
./minerd -a scrypt -o http://127.0.0.1:8332 -O username:password -t 4 -s 6
</pre>
<p>同样指定算法为scrypt，
连接localhost的8332端口，
其中username为矿工帐号，password为密码。
这里需要注意的是username一般为以下格式：&quot;网站注册名.矿工名&quot;</p>
<p><strong>正常情况</strong></p>
<p>如果一切正常，
则miderd窗口会间断打出状态信息，
一般为如下格式：</p>
<pre class="literal-block">
[2014-06-08 23:40:38] thread 1: 41964 hashes, 5.76 khash/s
[2014-06-08 23:40:38] accepted: 23/23 (100.00%), 22.98 khash/s (yay!!!)
[2014-06-08 23:41:31] thread 3: 343092 hashes, 5.74 khash/s
[2014-06-08 23:41:31] thread 2: 343416 hashes, 5.73 khash/s
</pre>
<p>前面的是日期时间，
然后是线程编号，
后面是具体的速率和哈希块什么的。</p>
<p>一段时间后应该有如上第二行的内容，
accepted表明工作成功，
最容易辨认的是那个&quot;yay!!!&quot;。
这说明你的矿机已经挖到东西了。</p>
<p><strong>异常情况</strong></p>
<p>连接失败什么的矿机会在一定时间内自动重试，
默认好像是十五秒。</p>
<p>另外如果连接成功，
但一直是&quot;booooo&quot;(五个o)，
说明当前的工作出问题，
没有被算入。
需要检查本地的配置什么的是否有问题。</p>
<p>这样，
一个CPU矿机就搭建完成了，
坐等收益吧。</p>
</div>

                </div><!-- /.entry-content -->
        </article>
        <license>
        <br/>
        This work by <a xmlns:cc="http://creativecommons.org/ns#" href="http://www.scutlaoyi.tk" property="cc:attributionName" rel="cc:attributionURL">scutLaoYi</a> is licensed under a <a rel="license" href="http://creativecommons.org/licenses/by-sa/4.0/">Creative Commons Attribution-ShareAlike 4.0 International License</a>.
        </license>
</section>
        </div><!--/span-->

                <div class="span3 well sidebar-nav" id="sidebar">
<ul class="nav nav-list">
<li class="nav-header"><h4><i class="icon-time"></i>time</h4></li>
<li><p id="pagetimer"></p></li>

<li class="nav-header"><h4><i class="icon-list-alt"></i>PAGE SENTENCE</h4></li>
<li>
<p id="page-sentence">
当你看到这句的时候，说明每页一句载入失败...烦请告知博主!谢谢!(^_^)
</p>
</li>
<script src="/add_ons/pagesentence/sentence.js"></script>
<script src="/add_ons/clock/clock.js"></script>
<script>
window.onload=function(){
      var pagetimer = document.getElementById("pagetimer");
      pagetimer.innerHTML = getcurrenttime();
  setInterval(function(){
      pagetimer.innerHTML = getcurrenttime();
      }, 1000);

    document.getElementById("page-sentence").innerHTML = generateSentence();
}
</script>
<li class="nav-header"><h4><i class="icon-external-link"></i>link</h4></li>
    <li><a href="http://github.com/scutlaoyi"><i class="icon-external-link"></i>my github</a></li>
<li class="nav-header"><h4><i class="icon-home icon-large"></i> social</h4></li>
<!--<li><a href="/" rel="alternate"><i
    class="icon-bookmark icon-large"></i>atom feed</a></li>-->
<li><a href="/feeds/all.rss.xml" rel="alternate"><i class="icon-bookmark icon-large"></i>rss feed</a></li>
    <li><a href=""><i class="icon--sign icon-large"></i></a></li>

<li class="nav-header"><h4><i class="icon-folder-close icon-large"></i>Categories</h4></li>
<li>
<a href="/category/coding.html">
    <i class="icon-folder-open icon-large"></i>Coding
</a>
</li>
<li>
<a href="/category/life.html">
    <i class="icon-folder-open icon-large"></i>Life
</a>
</li>
<li>
<a href="/category/linux.html">
    <i class="icon-folder-open icon-large"></i>Linux
</a>
</li>
<li>
<a href="/category/tool.html">
    <i class="icon-folder-open icon-large"></i>Tool
</a>
</li>
<li>
<a href="/category/web.html">
    <i class="icon-folder-open icon-large"></i>Web
</a>
</li>

<li class="nav-header"><h4><i class="icon-tags icon-large"></i>Tags</h4></li>
<li class="tag-2">
    <a href="/tag/audition.html">
        <i class="icon-tag icon-large"></i>audition
    </a>
</li>
<li class="tag-3">
    <a href="/tag/web-tool.html">
        <i class="icon-tag icon-large"></i>web tool
    </a>
</li>
<li class="tag-1">
    <a href="/tag/cc.html">
        <i class="icon-tag icon-large"></i>C/C++
    </a>
</li>
<li class="tag-4">
    <a href="/tag/android.html">
        <i class="icon-tag icon-large"></i>Android
    </a>
</li>
<li class="tag-2">
    <a href="/tag/recruitment.html">
        <i class="icon-tag icon-large"></i>recruitment
    </a>
</li>
<li class="tag-4">
    <a href="/tag/page-sentences.html">
        <i class="icon-tag icon-large"></i>page sentences
    </a>
</li>
<li class="tag-2">
    <a href="/tag/softwarearchitect.html">
        <i class="icon-tag icon-large"></i>SoftwareArchitect
    </a>
</li>
<li class="tag-2">
    <a href="/tag/github.html">
        <i class="icon-tag icon-large"></i>github
    </a>
</li>
<li class="tag-1">
    <a href="/tag/arch-linux.html">
        <i class="icon-tag icon-large"></i>Arch Linux
    </a>
</li>
<li class="tag-2">
    <a href="/tag/git.html">
        <i class="icon-tag icon-large"></i>git
    </a>
</li>
<li class="tag-4">
    <a href="/tag/xss.html">
        <i class="icon-tag icon-large"></i>xss
    </a>
</li>
<li class="tag-1">
    <a href="/tag/python.html">
        <i class="icon-tag icon-large"></i>Python
    </a>
</li>
<li class="tag-3">
    <a href="/tag/litecoin.html">
        <i class="icon-tag icon-large"></i>litecoin
    </a>
</li>
<li class="tag-1">
    <a href="/tag/data-structure.html">
        <i class="icon-tag icon-large"></i>data structure
    </a>
</li>
<li class="tag-2">
    <a href="/tag/socket.html">
        <i class="icon-tag icon-large"></i>socket
    </a>
</li>
<li class="tag-4">
    <a href="/tag/md5.html">
        <i class="icon-tag icon-large"></i>md5
    </a>
</li>
<li class="tag-3">
    <a href="/tag/vim.html">
        <i class="icon-tag icon-large"></i>Vim
    </a>
</li>
<li class="tag-2">
    <a href="/tag/bash.html">
        <i class="icon-tag icon-large"></i>Bash
    </a>
</li>


</ul>        </div><!--/.well -->

      </div><!--/row-->

      <hr>

      <footer>
        <address id="about">
                Proudly powered by <a href="http://pelican.notmyidea.org/">Pelican <i class="icon-external-link"></i></a>,
                                which takes great advantage of <a href="http://python.org">Python <i class="icon-external-link"></i></a>.
        </address><!-- /#about -->

        <p>The theme is from <a href="http://twitter.github.com/bootstrap/">Bootstrap from Twitter <i class="icon-external-link"></i></a>,
                   and <a href="http://fortawesome.github.com/Font-Awesome/">Font-Awesome <i class="icon-external-link"></i></a>, thanks!</p>
      </footer>

    </div><!--/.fluid-container-->



    <!-- Le javascript -->
    <!-- Placed at the end of the document so the pages load faster -->
    <script src="/theme/js/jquery-1.7.2.min.js"></script>
    <script src="/theme/js/bootstrap.min.js"></script>
  </body>
</html>